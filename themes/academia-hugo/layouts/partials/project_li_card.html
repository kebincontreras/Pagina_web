{{ $item := .item }}
{{ $widget := .widget }}


{{ $link := cond (isset $item.Params "publication_link") $item.Params.publication_link .link }}
{{ $target := .target }}

{{ $resource := ($item.Resources.ByType "image").GetMatch "*featured*" }}
{{ $js_tag_classes := delimit (apply (apply $item.Params.tags "replace" "." " " "-") "printf" "js-id-%s" ".") " " }}

<div class="project-card project-item isotope-item w-100 {{ $js_tag_classes | safeHTMLAttr }}" style="background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-radius: 8px; margin-bottom: 2rem; font-size:0.95rem;">
  <div class="d-flex align-items-center" style="min-height:180px;">
    <div class="flex-grow-1 p-4">
      <h3 class="mb-2" style="font-weight:700; font-size:1.15rem;"><a href="{{ $link }}" {{ $target | safeHTMLAttr }}>{{ $item.Title | markdownify | emojify }}</a></h3>
      {{ if or $item.Params.publication_badge $item.Params.publication }}
        <div class="text-muted mb-1" style="font-size:1rem;">
          {{ if $item.Params.publication_badge }}
            {{ $theme_index := site.Params.color_theme | default "default" }}
            {{ $theme := index site.Data.themes $theme_index }}
            {{ $primary := $theme.primary | default "#fc6f5c" }}
            <span style="background-color:{{ $primary }};color:#fff;font-weight:700;padding:4px 8px;border-radius:4px;display:inline-block;margin-right:8px">{{ $item.Params.publication_badge }}</span>
          {{ end }}
          {{ with $item.Params.publication }}{{ . | markdownify | emojify }}{{ end }}
        </div>
      {{ end }}
      {{ with $item.Params.authors }}
        <div class="mb-2" style="color:#888; font-size:0.95rem;">{{ delimit . ", " | markdownify | emojify }}</div>
      {{ end }}
      <div class="mb-2">
        {{ with $item.Params.summary }}<p class="mb-2" style="font-size:0.95rem;">{{ . | markdownify | emojify }}</p>{{ end }}
      </div>
      {{ with $item.Params.links }}
        <div class="mt-2">
          {{ range . }}
            <a href="{{ .url }}" class="btn btn-outline-success btn-sm mx-1 my-1" target="_blank" rel="noopener">{{ .name }}</a>
          {{ end }}
        </div>
      {{ end }}
    </div>
    {{ with $resource }}
      {{ $image := .Resize (printf "400x q90 %s") }}
      <div class="d-none d-md-block pr-4" style="max-width:320px;">
        <a href="{{ $link }}" {{ $target | safeHTMLAttr }}>
          <img src="{{ $image.RelPermalink }}" alt="" style="max-width:100%; max-height:160px; border-radius:6px;">
        </a>
      </div>
    {{ end }}
  </div>
</div>
